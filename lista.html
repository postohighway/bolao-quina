<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Bolão – Lista Pública</title>
  <style>
    :root{--green:#2e7d32;--orange:#f2b705;--line:#e5e7eb;--muted:#6b7280}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f6f7fb}
    header{background:var(--green);color:#fff;padding:14px 16px;font-weight:900;text-align:center;font-size:20px}
    .wrap{max-width:900px;margin:16px auto;padding:0 12px}
    .card{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:14px;margin-bottom:12px}
    select{width:100%;font:inherit;border:1px solid #cfd4dc;border-radius:10px;padding:10px 12px;background:#fff}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff}
    thead th{background:var(--orange);padding:12px 10px;text-align:left;font-weight:900}
    tbody td{padding:10px;border-bottom:1px solid var(--line)}
    tbody tr:last-child td{border-bottom:none}
    .hint{color:var(--muted);font-size:13px;margin-top:6px}
  </style>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
<header>Bolão – Lista Pública</header>

<div class="wrap">
  <div class="card">
    <label style="font-weight:900;">Concurso</label><br/>
    <select id="selectConcurso"></select>
    <div class="hint">Mostra apenas quem está marcado como “Pagou na Lotérica” ou “Pagou Waldecir”.</div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr><th style="width:60px;">#</th><th>Nome</th><th style="width:180px;">Pago</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
  const supabaseUrl = "https://reudmuwpcldymuwkdszk.supabase.co";
  const supabaseKey = "sb_publishable_i8PskNVeOK3YFniGzy2Eog_rjWlEZ7B";
  const sb = supabase.createClient(supabaseUrl, supabaseKey);

  let concursoSelecionadoId = null;
  const elSelect = document.getElementById("selectConcurso");
  const elTbody = document.getElementById("tbody");

  function esc(s){return String(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

  async function loadConcursos(){
    const { data, error } = await sb.from("concursos").select("id,nome,numero,created_at").order("created_at",{ascending:false});
    if(error){ elSelect.innerHTML = `<option>(erro)</option>`; return; }
    const concursos = data||[];
    elSelect.innerHTML = concursos.map(c=>{
      const label = `${c.nome}${c.numero ? " ("+c.numero+")" : ""}`;
      return `<option value="${c.id}">${label}</option>`;
    }).join("");
    concursoSelecionadoId = concursos[0]?.id || null;
    elSelect.value = concursoSelecionadoId || "";
    await loadLista();
  }

  async function loadLista(){
    if(!concursoSelecionadoId){ elTbody.innerHTML=""; return; }
    const { data, error } = await sb
      .from("participantes")
      .select("nome,pagou_waldecir,pagou_loterica")
      .eq("concurso_id", concursoSelecionadoId)
      .or("pagou_waldecir.eq.true,pagou_loterica.eq.true")
      .order("nome",{ascending:true});

    if(error){ elTbody.innerHTML=""; return; }
    const rows = data||[];
    elTbody.innerHTML = rows.map((p,i)=>{
      const pago = p.pagou_waldecir && p.pagou_loterica ? "Walde + Lotérica" : (p.pagou_loterica ? "Lotérica" : "Walde");
      return `<tr><td>${i+1}</td><td style="font-weight:900">${esc(p.nome)}</td><td>${pago}</td></tr>`;
    }).join("");
  }

  elSelect.addEventListener("change", async ()=>{
    concursoSelecionadoId = elSelect.value || null;
    await loadLista();
  });

  loadConcursos();
</script>
</body>
</html>
